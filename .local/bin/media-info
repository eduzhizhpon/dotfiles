#!/bin/bash

max_length=30
delay=0.5
scroll_speed=1

prefix=" ï€  "
prefix_len=${#prefix}
scroll_len=$((max_length - prefix_len))

# Source the common functions file
source ~/.local/bin/media-info-commons

last_song=""
active_player=""

while true; do
    active_player=$(get_active_player)

    if [ -n "$active_player" ]; then
        song=$(playerctl -p "$active_player" metadata --format '{{ artist }} - {{ title }}' 2>/dev/null)
        if is_player_paused "$active_player"; then
            song="$song (PAUSED)"
        fi
    else
        song=""
    fi

    [ -z "$song" ] && song="Nothing Playing"

    if [[ "$song" != "$last_song" ]]; then
        song_part=" $song        "
        len=${#song_part}
        last_song="$song"
        i=0
        # Create a long string for scrolling/padding
        scroll_song="$song_part"
        while [ ${#scroll_song} -lt $((len + scroll_len)) ]; do
            scroll_song+="$song_part"
        done
    fi

    scrolled_text="${scroll_song:i:scroll_len}"
    echo "$prefix$scrolled_text"

    ((i=(i + scroll_speed) % len))
    sleep $delay
done

